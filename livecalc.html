<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Live Odds Kalkylator ‚Äì Stats + xG med Slider & Presets</title>
  <style>
    body {font-family: Arial, sans-serif; background:#f9f9f9; color:#1a1a1a; margin:0; padding:20px;}
    h1 {color:#004aad;}
    .box {background:#fff; border:1px solid #ddd; border-radius:8px; padding:15px; margin-bottom:20px;}
    h3 {margin-top:15px; color:#004aad;}
    label {display:block; margin-top:8px;}
    input {width:100%; padding:6px; margin-top:3px; border:1px solid #ccc; border-radius:4px;}
    .btn {background:#004aad;color:#fff;padding:10px 16px;border:none;border-radius:6px;cursor:pointer;margin-top:12px;}
    .btn:active{background:#00337a;}
    .result {margin-top:15px; padding:10px; background:#eef6ff; border-left:4px solid #004aad; display:none;}
    .grid {display:grid;grid-template-columns:1fr 1fr;gap:20px;}
    .diff {margin-top:10px; padding:10px; background:#fffbe6; border-left:4px solid #f59e0b;}
    .bar-container {background:#eee; border-radius:4px; height:14px; width:100%; margin-top:4px; position:relative;}
    .bar {height:100%; border-radius:4px;}
    .bar.poisson {background:#004aad;}
    .bar.mc {background:#22c55e; position:absolute; top:0; left:0; opacity:0.7;}
    .slider-box {margin-top:10px;}
    .preset-buttons {margin-top:8px; display:flex; flex-wrap:wrap; gap:8px;}
    .preset-buttons .btn {background:#e5e7eb; color:#111; padding:6px 10px; font-size:13px;}
    .preset-buttons .btn:active{background:#d1d5db;}
  </style>
</head>
<body>
  <header style="background: linear-gradient(135deg, #004aad, #0066cc); color: white; padding: 20px; margin: -20px -20px 20px -20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h1 style="margin: 0; color: white;">‚öΩ Live Odds-kalkylator (Stats + xG)</h1>
    <p style="margin: 10px 0; color: rgba(255,255,255,0.9);">Mata in totalsiffror och/eller live xG. V√§lj om du vill k√∂ra enbart statistik eller hybrid med xG ‚Äì i hybrid kan du styra balansen med en slider eller snabbknappar.</p>
    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 15px;">
      <a href="index.html" style="color: white; text-decoration: none; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 20px; transition: all 0.3s ease; font-weight: 500;">üè† Hem</a>
      <a href="live.html" style="color: white; text-decoration: none; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 20px; transition: all 0.3s ease; font-weight: 500;">üìä Live Betting</a>
      <a href="prematch.html" style="color: white; text-decoration: none; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 20px; transition: all 0.3s ease; font-weight: 500;">üìã Pre-Match</a>
    </div>
  </header>

  <div class="box">
    <label>Minut <input id="minute" type="number" value="78"></label>
    <label>Till√§gg (estimat) <input id="stopp" type="number" value="5"></label>
    <label>Hemmalag m√•l (nu) <input id="sh" type="number" value="1"></label>
    <label>Bortalag m√•l (nu) <input id="sa" type="number" value="1"></label>
    <label>R√∂da kort Hemma <input id="red_h" type="number" value="0"></label>
    <label>R√∂da kort Borta <input id="red_a" type="number" value="0"></label>

    <h3>Hemmalag totalsiffror</h3>
    <label>Skott totalt <input id="shots_h" type="number" value="12"></label>
    <label>Skott p√• m√•l (SOT) <input id="sot_h" type="number" value="5"></label>
    <label>H√∂rnor <input id="corners_h" type="number" value="6"></label>
    <label>Dangerous Attacks <input id="da_h" type="number" value="65"></label>
    <label>xG hittills <input id="xg_h" type="number" step="0.01" value="1.8"></label>

    <h3>Bortalag totalsiffror</h3>
    <label>Skott totalt <input id="shots_a" type="number" value="9"></label>
    <label>Skott p√• m√•l (SOT) <input id="sot_a" type="number" value="3"></label>
    <label>H√∂rnor <input id="corners_a" type="number" value="4"></label>
    <label>Dangerous Attacks <input id="da_a" type="number" value="55"></label>
    <label>xG hittills <input id="xg_a" type="number" step="0.01" value="1.5"></label>

    <h3>Inst√§llningar</h3>
    <label><input type="radio" name="mode" value="stats" checked> Stats only</label>
    <label><input type="radio" name="mode" value="hybrid"> Hybrid (Stats + xG)</label>

    <div class="slider-box">
      <label>Hybrid vikt (Stats vs xG): 
        <span id="alphaLabel">50%</span> Stats / <span id="xgLabel">50%</span> xG
      </label>
      <input type="range" id="alpha" min="0" max="100" value="50" oninput="updateAlphaLabel()">

      <div class="preset-buttons">
        <button class="btn" type="button" onclick="setPreset(100)">Stats only</button>
        <button class="btn" type="button" onclick="setPreset(50)">50/50</button>
        <button class="btn" type="button" onclick="setPreset(0)">xG only</button>
        <button class="btn" type="button" onclick="setPreset(30)">30% Stats / 70% xG</button>
      </div>
    </div>

    <label>Antal simuleringar (Monte Carlo) <input id="sims" type="number" value="10000"></label>

    <button class="btn" onclick="runCalc()">Ber√§kna</button>
    <button class="btn" onclick="copyPrompt()">üìã Kopiera AI-prompt</button>
    <div id="out" class="result"></div>
  </div>

<script>
let lastResults = "";

function factorial(n){let r=1;for(let i=2;i<=n;i++)r*=i;return r;}
function pois(k,lam){return Math.exp(-lam)*Math.pow(lam,k)/(k?factorial(k):1);}
function pct(x){return (100*x).toFixed(1)+"%";}
function fair(p){return p>0?(1/p).toFixed(2):"‚àû";}
function samplePoisson(lambda){
  let L=Math.exp(-lambda), k=0, p=1;
  do {k++; p*=Math.random();} while(p>L);
  return k-1;
}
function diffText(label, pVal, mcVal){
  const d = (mcVal - pVal)*100;
  const sign = d>0?"+":"";
  const warn = Math.abs(d) > 1 ? " ‚ö†Ô∏è" : "";
  return `${label}: Œî ${sign}${d.toFixed(1)}%${warn}`;
}
function makeBar(pVal, mcVal){
  return `
    <div class="bar-container">
      <div class="bar poisson" style="width:${(pVal*100).toFixed(1)}%"></div>
      <div class="bar mc" style="width:${(mcVal*100).toFixed(1)}%"></div>
    </div>`;
}

// Rate fr√•n statistik
function calcRateStats(shots, sot, corners, da, minute){
  return ((shots*0.002) + (sot*0.006) + (corners*0.004) + (da*0.003)) / minute;
}

// Rate fr√•n xG
function calcRateXG(xg, minute){
  return xg / minute;
}

function updateAlphaLabel(){
  const alpha=document.getElementById("alpha").value;
  document.getElementById("alphaLabel").innerText=alpha+"%";
  document.getElementById("xgLabel").innerText=(100-alpha)+"%";
}

function setPreset(val){
  document.getElementById("alpha").value=val;
  updateAlphaLabel();
}

function runCalc(){
  const gv=id=>parseFloat(document.getElementById(id).value||0);
  const minute=gv("minute"), stopp=gv("stopp"), sh=gv("sh"), sa=gv("sa");
  const redH=gv("red_h"), redA=gv("red_a");
  const sims=parseInt(document.getElementById("sims").value)||10000;
  const mode=document.querySelector("input[name='mode']:checked").value;
  const alphaVal=parseInt(document.getElementById("alpha").value)/100;

  // Totalsiffror Home
  const shotsH=gv("shots_h"), sotH=gv("sot_h"), cornersH=gv("corners_h"), daH=gv("da_h"), xgH=gv("xg_h");
  // Totalsiffror Away
  const shotsA=gv("shots_a"), sotA=gv("sot_a"), cornersA=gv("corners_a"), daA=gv("da_a"), xgA=gv("xg_a");

  const R = Math.max(0,(90+stopp)-minute);

  // Rate per minut beroende p√• l√§ge
  let rH_stats=calcRateStats(shotsH,sotH,cornersH,daH,minute);
  let rA_stats=calcRateStats(shotsA,sotA,cornersA,daA,minute);
  let rH_xg=calcRateXG(xgH,minute);
  let rA_xg=calcRateXG(xgA,minute);

  let rH, rA;
  if(mode==="stats"){
    rH=rH_stats; rA=rA_stats;
  } else {
    rH=alphaVal*rH_stats+(1-alphaVal)*rH_xg;
    rA=alphaVal*rA_stats+(1-alphaVal)*rA_xg;
  }

  // Justeringar f√∂r st√§llning efter 70‚Äô
  if(minute>=70){
    const leadH=sh-sa;
    if(leadH>0) rH*=0.85;
    if(leadH<0) rH*=1.25;
    const leadA=sa-sh;
    if(leadA>0) rA*=0.85;
    if(leadA<0) rA*=1.25;
  }

  // R√∂da kort
  if(redA>redH){ rH*=1.3; rA*=0.8; }
  if(redH>redA){ rA*=1.3; rH*=0.8; }

  // Boost slutminuter
  if(R<=12){ rH*=1.1; rA*=1.1; }

  // F√∂rv√§ntade m√•l kvar
  const lamH=rH*R, lamA=rA*R;

  // --- Poisson ---
  const MAX=8; let noGoal=0,over05=0,over15=0,nextH=0,nextA=0,H=0,X=0,A=0;
  for(let i=0;i<=MAX;i++){for(let j=0;j<=MAX;j++){
    const p=pois(i,lamH)*pois(j,lamA);
    if(i===0&&j===0) noGoal+=p;
    if(i+j>=1) over05+=p;
    if(i+j>=2) over15+=p;
    if(i===1&&j===0) nextH+=p;
    if(i===0&&j===1) nextA+=p;
    const fh=sh+i, fa=sa+j;
    if(fh>fa)H+=p; else if(fh===fa)X+=p; else A+=p;
  }}

  // --- Monte Carlo ---
  let mc_noGoal=0,mc_over05=0,mc_over15=0,mc_nextH=0,mc_nextA=0,mc_H=0,mc_X=0,mc_A=0;
  for(let s=0;s<sims;s++){
    let gH=samplePoisson(lamH), gA=samplePoisson(lamA);
    if(gH===0&&gA===0) mc_noGoal++;
    if(gH+gA>=1) mc_over05++;
    if(gH+gA>=2) mc_over15++;
    if(gH===1&&gA===0) mc_nextH++;
    if(gH===0&&gA===1) mc_nextA++;
    const fh=sh+gH, fa=sa+gA;
    if(fh>fa) mc_H++; else if(fh===fa) mc_X++; else mc_A++;
  }
  mc_noGoal/=sims; mc_over05/=sims; mc_over15/=sims;
  mc_nextH/=sims; mc_nextA/=sims;
  mc_H/=sims; mc_X/=sims; mc_A/=sims;

  // Spara f√∂r prompt
  lastResults = `
F√∂rv√§ntade m√•l kvar (ber√§knat):
- Hemma: ${lamH.toFixed(2)} ‚Ä¢ Borta: ${lamA.toFixed(2)}

Poisson:
- No Goal: ${pct(noGoal)} (odds ${fair(noGoal)})
- Over 0.5: ${pct(over05)} (odds ${fair(over05)})
- Over 1.5: ${pct(over15)} (odds ${fair(over15)})
- 1X2: H ${pct(H)}, X ${pct(X)}, B ${pct(A)}

Monte Carlo (${sims} simuleringar):
- No Goal: ${pct(mc_noGoal)} (odds ${fair(mc_noGoal)})
- Over 0.5: ${pct(mc_over05)} (odds ${fair(mc_over05)})
- Over 1.5: ${pct(mc_over15)} (odds ${fair(mc_over15)})
- 1X2: H ${pct(mc_H)}, X ${pct(mc_X)}, B ${pct(mc_A)}
`;

  // Visa
  const out=document.getElementById("out");
  out.style.display="block";
  out.innerHTML=`
    <b>F√∂rv√§ntade m√•l kvar</b><br>
    Hemma: ${lamH.toFixed(2)} ‚Ä¢ Borta: ${lamA.toFixed(2)}<br><br>

    <div class="grid">
      <div>
        <u><b>Poisson (exakt)</b></u><br>
        No Goal: ${pct(noGoal)} (odds ${fair(noGoal)}) ${makeBar(noGoal, mc_noGoal)}<br>
        Over 0.5: ${pct(over05)} (odds ${fair(over05)}) ${makeBar(over05, mc_over05)}<br>
        Over 1.5: ${pct(over15)} (odds ${fair(over15)}) ${makeBar(over15, mc_over15)}<br>
        Next Goal ‚Äì Home: ${pct(nextH)} ‚Ä¢ Away: ${pct(nextA)} ${makeBar(nextH, mc_nextH)}<br><br>
        1X2 Fulltid:<br>
        H: ${pct(H)} (odds ${fair(H)}) ${makeBar(H, mc_H)}<br>
        X: ${pct(X)} (odds ${fair(X)}) ${makeBar(X, mc_X)}<br>
        B: ${pct(A)} (odds ${fair(A)}) ${makeBar(A, mc_A)}
      </div>
      <div>
        <u><b>Monte Carlo (${sims} simuleringar)</b></u><br>
        (Gr√∂n stapel) visas ovan i j√§mf√∂relse med bl√• (Poisson).<br><br>
        <div class="diff">
          <u><b>Skillnader (Monte Carlo ‚Äì Poisson)</b></u><br>
          ${diffText("No Goal", noGoal, mc_noGoal)}<br>
          ${diffText("Over 0.5", over05, mc_over05)}<br>
          ${diffText("Over 1.5", over15, mc_over15)}<br>
          ${diffText("1X2 Home", H, mc_H)}<br>
          ${diffText("1X2 Draw", X, mc_X)}<br>
          ${diffText("1X2 Away", A, mc_A)}
        </div>
      </div>
    </div>
  `;
}

function copyPrompt(){
  if(!lastResults){alert("K√∂r en ber√§kning f√∂rst!"); return;}
  const prompt = `Analysera dessa sannolikheter baserade p√• live-statistik och xG:\n${lastResults}`;
  navigator.clipboard.writeText(prompt).then(()=>{
    alert("AI-prompt kopierad till urklipp ‚úÖ");
  });
}
</script>
</body>
</html>
